import{b as i,j as e,Z as D,F as _,E as F,e as K,P as W,f as B,A as Y,h as H,i as U,R as V}from"./react-vendor-CIIQvFGe.js";import{C as q,V as g,a as N,D as $,b as T,c as Q,B as X,d as Z,Q as J,e as ee}from"./three-vendor-CBXY8f2o.js";import{P as se}from"./cannon-vendor-WYvRlrq9.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();const te=()=>{const[a,t]=i.useState({forward:!1,backward:!1,left:!1,right:!1,jump:!1});return i.useEffect(()=>{const s=n=>{switch(n.code){case"KeyW":case"ArrowUp":t(r=>({...r,forward:!0}));break;case"KeyS":case"ArrowDown":t(r=>({...r,backward:!0}));break;case"KeyA":case"ArrowLeft":t(r=>({...r,left:!0}));break;case"KeyD":case"ArrowRight":t(r=>({...r,right:!0}));break;case"Space":t(r=>({...r,jump:!0}));break}},o=n=>{switch(n.code){case"KeyW":case"ArrowUp":t(r=>({...r,forward:!1}));break;case"KeyS":case"ArrowDown":t(r=>({...r,backward:!1}));break;case"KeyA":case"ArrowLeft":t(r=>({...r,left:!1}));break;case"KeyD":case"ArrowRight":t(r=>({...r,right:!1}));break;case"Space":t(r=>({...r,jump:!1}));break}};return document.addEventListener("keydown",s),document.addEventListener("keyup",o),()=>{document.removeEventListener("keydown",s),document.removeEventListener("keyup",o)}},[]),a};var y=(a=>(a.FIRST_PERSON="FIRST_PERSON",a.THIRD_PERSON="THIRD_PERSON",a))(y||{}),b=(a=>(a.IDLE="IDLE",a.PLAYING="PLAYING",a.GAME_OVER="GAME_OVER",a))(b||{});const L=new q([new g(0,0,45),new g(-90,0,-20),new g(0,0,-130),new g(90,0,-20),new g(0,0,45),new g(-100,0,130),new g(0,0,230),new g(100,0,130)],!0),re=2e-6,oe=15e-6,I=.0012,ae=.0028,ne=2e-5,ie=({speed:a,isFlying:t})=>{const s=i.useRef(null),o=i.useRef(null),n=i.useRef(null),r=i.useRef(null),c=i.useRef(null),x=i.useRef(null);N(w=>{if(!s.current)return;const M=w.clock.getElapsedTime(),f=t?-Math.PI/2:.2;if(s.current.rotation.x=T.lerp(s.current.rotation.x,f,.1),t)o.current&&n.current&&r.current&&c.current&&(o.current.rotation.x=Math.PI,n.current.rotation.x=Math.PI,r.current.rotation.x=0,c.current.rotation.x=0);else{const j=M*a*12e3;o.current&&n.current&&r.current&&c.current&&(o.current.rotation.x=Math.sin(j)*.8,n.current.rotation.x=-Math.sin(j)*.8,r.current.rotation.x=-Math.sin(j)*.8,c.current.rotation.x=Math.sin(j)*.8,o.current.rotation.z=0,n.current.rotation.z=0)}if(x.current){const j=t?Math.sin(M*20)*.1:Math.sin(M*5+a*1e3)*.2,G=t?.2:.1;x.current.rotation.x=G+j}});const m="#fca5a5",d="#2563eb",l="#ef4444";return e.jsx("group",{ref:s,children:e.jsxs("group",{position:[0,.9,0],children:[e.jsxs("mesh",{position:[0,.7,0],children:[e.jsx("boxGeometry",{args:[.3,.3,.3]}),e.jsx("meshStandardMaterial",{color:m})]}),e.jsxs("mesh",{position:[0,.15,0],children:[e.jsx("boxGeometry",{args:[.4,.8,.25]}),e.jsx("meshStandardMaterial",{color:d})]}),e.jsxs("mesh",{ref:x,position:[0,.5,.15],rotation:[.1,0,0],children:[e.jsx("planeGeometry",{args:[.6,1.2]}),e.jsx("meshStandardMaterial",{color:"#dc2626",side:$})]}),e.jsxs("mesh",{ref:o,position:[-.25,.4,0],children:[e.jsx("boxGeometry",{args:[.12,.8,.12]}),e.jsx("meshStandardMaterial",{color:d}),e.jsxs("mesh",{position:[0,-.4,0],children:[e.jsx("boxGeometry",{args:[.13,.13,.13]}),e.jsx("meshStandardMaterial",{color:m})]})]}),e.jsxs("mesh",{ref:n,position:[.25,.4,0],children:[e.jsx("boxGeometry",{args:[.12,.8,.12]}),e.jsx("meshStandardMaterial",{color:d}),e.jsxs("mesh",{position:[0,-.4,0],children:[e.jsx("boxGeometry",{args:[.13,.13,.13]}),e.jsx("meshStandardMaterial",{color:m})]})]}),e.jsxs("group",{ref:r,position:[-.1,-.25,0],children:[e.jsxs("mesh",{position:[0,-.3,0],children:[e.jsx("boxGeometry",{args:[.14,.7,.14]}),e.jsx("meshStandardMaterial",{color:d})]}),e.jsxs("mesh",{position:[0,-.65,0],children:[e.jsx("boxGeometry",{args:[.15,.3,.15]}),e.jsx("meshStandardMaterial",{color:l})]})]}),e.jsxs("group",{ref:c,position:[.1,-.25,0],children:[e.jsxs("mesh",{position:[0,-.3,0],children:[e.jsx("boxGeometry",{args:[.14,.7,.14]}),e.jsx("meshStandardMaterial",{color:d})]}),e.jsxs("mesh",{position:[0,-.65,0],children:[e.jsx("boxGeometry",{args:[.15,.3,.15]}),e.jsx("meshStandardMaterial",{color:l})]})]})]})})},le=({viewMode:a,gameStatus:t,onGameOver:s,setScore:o,setLaps:n,setIsFlying:r,setSpeed:c})=>{const x=i.useRef(null),m=te(),d=i.useRef(0),l=i.useRef(0),u=i.useRef(15),w=i.useRef(5),M=i.useRef(0);return i.useEffect(()=>{const f=j=>{u.current=Math.max(5,Math.min(400,u.current+j.deltaY*.1)),w.current=Math.max(2,u.current*.4)};return window.addEventListener("wheel",f),()=>window.removeEventListener("wheel",f)},[]),N(f=>{if(!x.current)return;if(t===b.PLAYING){const{forward:v,backward:E}=m;if(v){let R=re;l.current>I*.8&&(R=oe),l.current=Math.min(l.current+R,ae)}else E&&(l.current=Math.max(l.current-ne,0));const k=d.current+l.current;Math.floor(k)>Math.floor(d.current)&&n(R=>R+1),d.current=k%1,o(R=>R+Math.floor(l.current*1e4))}else l.current=0;M.current+=1,M.current%5===0&&(c(l.current),r(l.current>I));const j=l.current>I,G=L.getPointAt(d.current),P=L.getPointAt((d.current+.01)%1),A=j?6:0,S=T.lerp(x.current.position.y,A,.05);if(x.current.position.set(G.x,S,G.z),x.current.lookAt(P.x,S,P.z),a===y.THIRD_PERSON){const E=L.getTangentAt(d.current).normalize().clone().multiplyScalar(-u.current);E.y+=w.current;const k=x.current.position.clone().add(E);f.camera.position.lerp(k,.1),f.camera.lookAt(x.current.position)}else{const v=x.current.position.clone().add(new g(0,1.6,0));j&&(v.y-=.5),f.camera.position.lerp(v,.5),f.camera.lookAt(P.x,S,P.z)}}),e.jsx("group",{ref:x,children:a===y.THIRD_PERSON&&e.jsx(ie,{speed:l.current,isFlying:l.current>I})})},p=(a,t)=>Math.floor(Math.random()*(t-a+1))+a,h={cksWhite:"#f3f4f6",cksBlue:"#003087",roofGold:"#f59e0b",pillarRed:"#991b1b",tileFloor:"#cbd5e1",grass:"#166534",t101Green:"#aecbfa"},ce=()=>e.jsxs("group",{position:[280,0,-300],children:[e.jsxs("mesh",{position:[0,15,0],children:[e.jsx("boxGeometry",{args:[40,30,40]}),e.jsx("meshStandardMaterial",{color:"#64748b"})]}),[...Array(8)].map((a,t)=>e.jsxs("group",{position:[0,30+t*18,0],children:[e.jsxs("mesh",{position:[0,9,0],children:[e.jsx("cylinderGeometry",{args:[14,10,18,4],rotation:[0,Math.PI/4,0]}),e.jsx("meshStandardMaterial",{color:h.t101Green,metalness:.8,roughness:.2})]}),e.jsxs("mesh",{position:[12,9,12],children:[e.jsx("boxGeometry",{args:[2,10,2]}),e.jsx("meshStandardMaterial",{color:"#cbd5e1"})]}),e.jsxs("mesh",{position:[-12,9,12],children:[e.jsx("boxGeometry",{args:[2,10,2]}),e.jsx("meshStandardMaterial",{color:"#cbd5e1"})]}),e.jsxs("mesh",{position:[12,9,-12],children:[e.jsx("boxGeometry",{args:[2,10,2]}),e.jsx("meshStandardMaterial",{color:"#cbd5e1"})]}),e.jsxs("mesh",{position:[-12,9,-12],children:[e.jsx("boxGeometry",{args:[2,10,2]}),e.jsx("meshStandardMaterial",{color:"#cbd5e1"})]})]},t)),e.jsxs("group",{position:[0,174,0],children:[e.jsxs("mesh",{position:[0,5,0],children:[e.jsx("boxGeometry",{args:[8,10,8]}),e.jsx("meshStandardMaterial",{color:h.t101Green})]}),e.jsxs("mesh",{position:[0,25,0],children:[e.jsx("cylinderGeometry",{args:[1,6,30,4],rotation:[0,Math.PI/4,0]}),e.jsx("meshStandardMaterial",{color:h.t101Green})]}),e.jsxs("mesh",{position:[0,45,0],children:[e.jsx("cylinderGeometry",{args:[.2,.5,20,8]}),e.jsx("meshStandardMaterial",{color:"#cbd5e1"})]})]})]}),de=()=>e.jsxs("group",{position:[-200,0,100],children:[e.jsxs("mesh",{position:[0,40,0],children:[e.jsx("boxGeometry",{args:[30,80,20]}),e.jsx("meshStandardMaterial",{color:"#fca5a5"})]}),e.jsxs("mesh",{position:[0,85,0],children:[e.jsx("boxGeometry",{args:[25,10,15]}),e.jsx("meshStandardMaterial",{color:"#fca5a5"})]})]}),xe=()=>e.jsxs("group",{position:[0,0,-60],children:[e.jsxs("mesh",{position:[0,4,0],children:[e.jsx("boxGeometry",{args:[45,8,45]}),e.jsx("meshStandardMaterial",{color:h.cksWhite})]}),e.jsxs("group",{position:[0,0,28],children:[e.jsxs("mesh",{position:[0,2,0],rotation:[-Math.PI/6,0,0],children:[e.jsx("boxGeometry",{args:[16,12,1]}),e.jsx("meshStandardMaterial",{color:"#e5e7eb"})]}),e.jsxs("mesh",{position:[0,2.1,0],rotation:[-Math.PI/6,0,0],children:[e.jsx("planeGeometry",{args:[4,12]}),e.jsx("meshStandardMaterial",{color:"#d1d5db"})]})]}),e.jsxs("mesh",{position:[0,18,0],children:[e.jsx("boxGeometry",{args:[32,20,32]}),e.jsx("meshStandardMaterial",{color:h.cksWhite})]}),e.jsxs("mesh",{position:[0,29,0],children:[e.jsx("boxGeometry",{args:[34,2,34]}),e.jsx("meshStandardMaterial",{color:"#dbeafe"})]}),e.jsxs("group",{position:[0,30,0],children:[e.jsxs("mesh",{position:[0,2,0],rotation:[0,Math.PI/8,0],children:[e.jsx("cylinderGeometry",{args:[22,26,4,8]}),e.jsx("meshStandardMaterial",{color:h.cksBlue})]}),e.jsxs("mesh",{position:[0,8,0],rotation:[0,Math.PI/8,0],children:[e.jsx("cylinderGeometry",{args:[0,22,12,8]}),e.jsx("meshStandardMaterial",{color:h.cksBlue})]}),e.jsxs("mesh",{position:[0,14.5,0],children:[e.jsx("cylinderGeometry",{args:[.5,.5,2,8]}),e.jsx("meshStandardMaterial",{color:"#fbbf24",metalness:.8})]})]}),e.jsxs("mesh",{position:[0,13,16.1],children:[e.jsx("planeGeometry",{args:[6,10]}),e.jsx("meshStandardMaterial",{color:"#7f1d1d"})]})]}),O=({position:a,rotationY:t})=>e.jsxs("group",{position:a,rotation:[0,t,0],children:[e.jsxs("mesh",{position:[0,2,0],children:[e.jsx("boxGeometry",{args:[30,4,20]}),e.jsx("meshStandardMaterial",{color:h.cksWhite})]}),e.jsxs("mesh",{position:[0,10,0],children:[e.jsx("boxGeometry",{args:[28,12,18]}),e.jsx("meshStandardMaterial",{color:h.pillarRed})]}),e.jsxs(Z,{range:6,position:[0,8,9.5],children:[e.jsx("cylinderGeometry",{args:[.6,.6,12]}),e.jsx("meshStandardMaterial",{color:"#7f1d1d"}),[-12,-7,-2,2,7,12].map((s,o)=>e.jsx("group",{position:[s,0,0],children:e.jsx("mesh",{})},o))]}),e.jsxs("group",{position:[0,16,0],children:[e.jsxs("mesh",{children:[e.jsx("coneGeometry",{args:[22,10,4],rotation:[0,Math.PI/4,0]}),e.jsx("meshStandardMaterial",{color:h.roofGold})]}),e.jsxs("mesh",{position:[0,5,0],children:[e.jsx("boxGeometry",{args:[30,1,.5]}),e.jsx("meshStandardMaterial",{color:h.roofGold})]})]})]}),he=()=>e.jsxs("group",{position:[0,0,150],children:[[-20,-12,-5,5,12,20].map((s,o)=>e.jsxs("mesh",{position:[s,18/2,0],children:[e.jsx("boxGeometry",{args:[2,18,2]}),e.jsx("meshStandardMaterial",{color:h.cksWhite})]},o)),e.jsxs("mesh",{position:[0,12,0],children:[e.jsx("boxGeometry",{args:[44,2,2.5]}),e.jsx("meshStandardMaterial",{color:h.cksWhite})]}),e.jsxs("mesh",{position:[0,15,0],children:[e.jsx("boxGeometry",{args:[28,1.5,2.5]}),e.jsx("meshStandardMaterial",{color:h.cksWhite})]}),e.jsxs("mesh",{position:[0,19,0],children:[e.jsx("coneGeometry",{args:[14,6,4],rotation:[0,Math.PI/4,0]}),e.jsx("meshStandardMaterial",{color:h.cksBlue})]}),e.jsxs("mesh",{position:[-16,17,0],children:[e.jsx("coneGeometry",{args:[8,5,4],rotation:[0,Math.PI/4,0]}),e.jsx("meshStandardMaterial",{color:h.cksBlue})]}),e.jsxs("mesh",{position:[16,17,0],children:[e.jsx("coneGeometry",{args:[8,5,4],rotation:[0,Math.PI/4,0]}),e.jsx("meshStandardMaterial",{color:h.cksBlue})]})]}),me=()=>e.jsxs("group",{children:[e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,.15,45],children:[e.jsx("planeGeometry",{args:[20,180]}),e.jsx("meshStandardMaterial",{color:"#e5e5e5"})]}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,.1,45],receiveShadow:!0,children:[e.jsx("planeGeometry",{args:[120,220]}),e.jsx("meshStandardMaterial",{color:h.tileFloor,roughness:.8})]}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[-80,.05,45],children:[e.jsx("planeGeometry",{args:[60,220]}),e.jsx("meshStandardMaterial",{color:h.grass})]}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[80,.05,45],children:[e.jsx("planeGeometry",{args:[60,220]}),e.jsx("meshStandardMaterial",{color:h.grass})]}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[-80,.1,45],children:[e.jsx("circleGeometry",{args:[20,32]}),e.jsx("meshStandardMaterial",{color:"#3b82f6",roughness:.1,metalness:.5})]}),e.jsxs("mesh",{position:[-80,1,45],rotation:[0,Math.PI/4,0],children:[e.jsx("boxGeometry",{args:[30,.5,2]}),e.jsx("meshStandardMaterial",{color:"#fff"})]}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[80,.1,45],children:[e.jsx("circleGeometry",{args:[20,32]}),e.jsx("meshStandardMaterial",{color:"#3b82f6",roughness:.1,metalness:.5})]}),e.jsx(O,{position:[-70,0,40],rotationY:Math.PI/2}),e.jsx(O,{position:[70,0,40],rotationY:-Math.PI/2})]}),ue=({position:a,scale:t})=>e.jsxs("group",{position:a,scale:[t,t,t],children:[e.jsxs("mesh",{position:[0,1.5,0],children:[e.jsx("cylinderGeometry",{args:[.3,.5,3]}),e.jsx("meshStandardMaterial",{color:"#4a3728"})]}),e.jsxs("mesh",{position:[0,3,0],children:[e.jsx("coneGeometry",{args:[2.5,3,8]}),e.jsx("meshStandardMaterial",{color:"#14532d"})]}),e.jsxs("mesh",{position:[0,4.5,0],children:[e.jsx("coneGeometry",{args:[2,2.5,8]}),e.jsx("meshStandardMaterial",{color:"#15803d"})]}),e.jsxs("mesh",{position:[0,6,0],children:[e.jsx("coneGeometry",{args:[1.2,2,8]}),e.jsx("meshStandardMaterial",{color:"#16a34a"})]})]}),je=()=>{const a=i.useMemo(()=>{const t=[];for(let s=0;s<60;s++)t.push({pos:[p(-180,-110),0,p(50,200)],scale:.8+Math.random()*.5});for(let s=0;s<60;s++)t.push({pos:[p(110,180),0,p(50,200)],scale:.8+Math.random()*.5});for(let s=0;s<60;s++)t.push({pos:[p(-180,-110),0,p(-150,0)],scale:.8+Math.random()*.5});for(let s=0;s<60;s++)t.push({pos:[p(110,180),0,p(-150,0)],scale:.8+Math.random()*.5});return t},[]);return e.jsx("group",{children:a.map((t,s)=>e.jsx(ue,{position:t.pos,scale:t.scale},s))})},pe=()=>{const t=i.useMemo(()=>{const s=[];for(let o=0;o<200;o++){const n=Math.random()*Math.PI*2,r=250+Math.random()*200,c=Math.cos(n)*r,x=Math.sin(n)*r,m=20+Math.random()*80,d=10+Math.random()*20;s.push({position:[c,m/2,x],args:[d,m,d],color:Math.random()>.5?"#94a3b8":"#64748b"})}return s},[]);return e.jsx("group",{children:t.map((s,o)=>e.jsxs("mesh",{position:s.position,children:[e.jsx("boxGeometry",{args:s.args}),e.jsx("meshStandardMaterial",{color:s.color})]},o))})},fe=({type:a,colorClothes:t,colorSkin:s,colorPants:o,speed:n})=>{const r=i.useRef(null),c=i.useRef(null),x=i.useRef(null),m=i.useRef(null),d=a==="kid"?.6:1;return N(l=>{const u=l.clock.getElapsedTime()*n*40;r.current&&c.current&&x.current&&m.current&&(r.current.rotation.x=Math.sin(u)*.5,c.current.rotation.x=-Math.sin(u)*.5,x.current.rotation.x=-Math.sin(u)*.6,m.current.rotation.x=Math.sin(u)*.6)}),e.jsxs("group",{scale:[d,d,d],children:[e.jsxs("mesh",{position:[0,.9,0],children:[e.jsx("boxGeometry",{args:[.4,.6,.2]}),e.jsx("meshStandardMaterial",{color:t})]}),e.jsxs("mesh",{position:[0,1.35,0],children:[e.jsx("boxGeometry",{args:[.25,.3,.25]}),e.jsx("meshStandardMaterial",{color:s})]}),e.jsxs("mesh",{ref:r,position:[-.28,1.1,0],rotation:[0,0,.1],children:[e.jsx("boxGeometry",{args:[.12,.6,.12]}),e.jsx("meshStandardMaterial",{color:t}),e.jsxs("mesh",{position:[0,-.35,0],children:[e.jsx("boxGeometry",{args:[.1,.15,.1]}),e.jsx("meshStandardMaterial",{color:s})]})]}),e.jsxs("mesh",{ref:c,position:[.28,1.1,0],rotation:[0,0,-.1],children:[e.jsx("boxGeometry",{args:[.12,.6,.12]}),e.jsx("meshStandardMaterial",{color:t}),e.jsxs("mesh",{position:[0,-.35,0],children:[e.jsx("boxGeometry",{args:[.1,.15,.1]}),e.jsx("meshStandardMaterial",{color:s})]})]}),e.jsxs("mesh",{ref:x,position:[-.1,.3,0],children:[e.jsx("boxGeometry",{args:[.15,.6,.15]}),e.jsx("meshStandardMaterial",{color:o})]}),e.jsxs("mesh",{ref:m,position:[.1,.3,0],children:[e.jsx("boxGeometry",{args:[.15,.6,.15]}),e.jsx("meshStandardMaterial",{color:o})]})]})},ge=({color:a,speed:t})=>{const s=i.useRef(null);return N(o=>{const n=o.clock.getElapsedTime()*t*60;s.current&&(s.current.position.y=.2+Math.abs(Math.sin(n))*.05,s.current.rotation.z=Math.sin(n)*.05)}),e.jsxs("group",{ref:s,children:[e.jsxs("mesh",{position:[0,0,0],children:[e.jsx("boxGeometry",{args:[.2,.2,.4]}),e.jsx("meshStandardMaterial",{color:a})]}),e.jsxs("mesh",{position:[0,.15,.2],children:[e.jsx("boxGeometry",{args:[.15,.15,.15]}),e.jsx("meshStandardMaterial",{color:a})]})]})},z=({type:a,position:t,boundary:s})=>{const o=i.useRef(null),n=i.useRef(Math.random()*.03+.015),r=i.useRef(new g(Math.random()-.5,0,Math.random()-.5).normalize()),c=i.useMemo(()=>({clothes:["#ef4444","#3b82f6","#10b981","#f59e0b","#8b5cf6","#6366f1"][Math.floor(Math.random()*6)],skin:["#fca5a5","#fdba74","#d4d4d8"][Math.floor(Math.random()*3)],pants:["#1e293b","#334155","#475569","#1f2937"][Math.floor(Math.random()*4)],pet:["#a8a29e","#78716c","#d6d3d1"][Math.floor(Math.random()*3)]}),[]);return N(x=>{if(!o.current)return;o.current.position.add(r.current.clone().multiplyScalar(n.current));const m=Math.atan2(r.current.x,r.current.z),d=new J().setFromAxisAngle(new g(0,1,0),m);o.current.quaternion.slerp(d,.1);const l=o.current.position;(l.x<s.x[0]||l.x>s.x[1]||l.z<s.z[0]||l.z>s.z[1])&&(r.current.negate(),r.current.x+=(Math.random()-.5)*.8,r.current.z+=(Math.random()-.5)*.8,r.current.normalize())}),e.jsx("group",{ref:o,position:t,children:a==="pet"?e.jsx(ge,{color:c.pet,speed:n.current}):e.jsx(fe,{type:a,colorClothes:c.clothes,colorSkin:c.skin,colorPants:c.pants,speed:n.current})})},be=()=>{const a=i.useMemo(()=>{const s=[];for(let o=0;o<30;o++)s.push({id:o,type:Math.random()>.3?"adult":Math.random()>.5?"kid":"pet",position:[p(-40,40),0,p(20,100)],boundary:{x:[-50,50],z:[10,110]}});return s},[]),t=i.useMemo(()=>{const s=[];for(let o=0;o<10;o++)s.push({id:o+100,type:"adult",position:[p(60,80),0,p(30,50)],boundary:{x:[55,85],z:[25,55]}});return s},[]);return e.jsxs(e.Fragment,{children:[a.map(({id:s,...o})=>e.jsx(z,{...o},s)),t.map(({id:s,...o})=>e.jsx(z,{...o},s))]})},Me=({gameStatus:a})=>e.jsxs(e.Fragment,{children:[e.jsx("ambientLight",{intensity:.8}),e.jsx("directionalLight",{position:[100,200,50],intensity:2.5,castShadow:!0,"shadow-mapSize":[2048,2048],"shadow-camera-left":-300,"shadow-camera-right":300,"shadow-camera-top":300,"shadow-camera-bottom":-300}),e.jsx(Q,{preset:"city"}),e.jsxs("mesh",{position:[0,200,0],children:[e.jsx("sphereGeometry",{args:[800,32,32]}),e.jsx("meshBasicMaterial",{color:"#87ceeb",side:X})]}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.1,0],receiveShadow:!0,children:[e.jsx("planeGeometry",{args:[1500,1500]}),e.jsx("meshStandardMaterial",{color:"#e2e8f0"})]}),e.jsx(xe,{}),e.jsx(he,{}),e.jsx(me,{}),e.jsx(je,{}),e.jsx(be,{}),e.jsx(pe,{}),e.jsx(ce,{}),e.jsx(de,{})]}),ye=({score:a,laps:t,isFlying:s,viewMode:o,gameStatus:n,speedKmh:r=0,onToggleView:c,onStartGame:x})=>{const[m,d]=i.useState("");i.useEffect(()=>{t>0&&(d(`第 ${t} 圈達成！`),setTimeout(()=>d(""),4e3))},[t]);const l=192;return e.jsxs("div",{className:"absolute inset-0 pointer-events-none flex flex-col justify-between p-6 z-10 font-sans",children:[e.jsxs("div",{className:"flex justify-between items-start pointer-events-auto",children:[e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-md p-4 rounded-lg border border-white/20 shadow-lg min-w-[240px]",children:[e.jsxs("h1",{className:"text-2xl font-black text-white tracking-wider flex items-center gap-2",children:[e.jsx(D,{className:"text-yellow-400 fill-current"})," 中正紀念堂 ",e.jsx("span",{className:"text-blue-400 text-sm font-normal",children:"跑步模擬"})]}),e.jsxs("div",{className:"flex justify-between items-end mt-2",children:[e.jsxs("div",{className:"text-gray-300 font-mono text-sm",children:["里程: ",(a/100).toFixed(1)," m"]}),e.jsxs("div",{className:"text-yellow-400 font-black text-3xl flex items-center gap-2",children:[e.jsx(_,{size:20})," ",t," ",e.jsx("span",{className:"text-xs text-gray-400 font-normal",children:"LAPS"})]})]})]}),e.jsx("button",{onClick:c,className:"bg-white/10 hover:bg-white/20 text-white p-3 rounded-lg backdrop-blur transition-all active:scale-95 ring-1 ring-white/20 flex items-center gap-2",children:o===y.FIRST_PERSON?e.jsxs(e.Fragment,{children:[e.jsx(F,{size:20,className:"text-blue-400"}),e.jsx("span",{className:"hidden md:inline text-sm font-bold",children:"第一人稱"})]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{size:20,className:"text-blue-400"}),e.jsx("span",{className:"hidden md:inline text-sm font-bold",children:"第三人稱"})]})})]}),n===b.PLAYING&&e.jsx("div",{className:"absolute top-24 right-6 flex flex-col items-end gap-2",children:e.jsxs("div",{className:`
              relative overflow-hidden
              flex flex-col items-end justify-center px-6 py-4 rounded-xl border-2 shadow-2xl backdrop-blur-md transition-all duration-300 w-64
              ${s?"bg-blue-900/80 border-blue-400 text-white shadow-blue-500/50":"bg-slate-800/80 border-gray-500 text-white"}
            `,children:[e.jsx("div",{className:"absolute top-2 left-4 opacity-50",children:s?e.jsx(W,{size:48}):e.jsx(B,{size:48})}),e.jsxs("div",{className:"flex items-baseline gap-1 z-10",children:[e.jsx("span",{className:"text-5xl font-black font-mono tracking-tighter",children:Math.floor(r)}),e.jsx("span",{className:"text-sm font-bold text-gray-400",children:"KM/H"})]}),e.jsx("div",{className:"w-full h-2 bg-gray-700 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-200 ${s?"bg-blue-400 animate-pulse":"bg-yellow-400"}`,style:{width:`${Math.min(r/l*100,100)}%`}})}),e.jsxs("div",{className:"flex justify-between w-full text-[10px] text-gray-400 mt-1 font-mono",children:[e.jsx("span",{children:"GROUND"}),e.jsxs("span",{children:["TAKEOFF (",l,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3 pt-2 border-t border-white/10 w-full justify-end text-sm font-mono text-cyan-300",children:[e.jsx(Y,{size:14}),e.jsxs("span",{children:["ALT: ",s?"LOW ALT":"GROUND"]})]})]})}),n===b.IDLE&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/70 backdrop-blur-sm pointer-events-auto z-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-red-500 mb-2 drop-shadow-2xl italic",children:"悠遊中正紀念堂"}),e.jsx("p",{className:"text-xl text-gray-300 mb-8 font-light",children:"慢跑與飛行模擬"}),e.jsxs("div",{className:"space-y-6 bg-slate-900/90 p-8 rounded-2xl border border-blue-500/30 max-w-md mx-auto shadow-2xl shadow-blue-900/20",children:[e.jsxs("div",{className:"text-gray-300 flex flex-col gap-4 text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("kbd",{className:"bg-white/10 px-3 py-2 rounded text-blue-400 font-bold mb-1",children:"W"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-white",children:"加速 (按住)"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["時速達到 ",l,"km/h 以上起飛"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("kbd",{className:"bg-white/10 px-3 py-2 rounded text-red-400 font-bold mb-1",children:"S"})}),e.jsx("span",{children:"空氣煞車 / 減速"})]})]}),e.jsxs("button",{onClick:x,className:"w-full bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white font-bold py-4 px-8 rounded-xl text-xl transition-all shadow-lg hover:shadow-blue-500/50 hover:-translate-y-1 flex justify-center items-center gap-2",children:[e.jsx(H,{fill:"currentColor",size:20})," 開始跑步"]})]})]})}),m&&e.jsx("div",{className:"absolute top-32 left-1/2 -translate-x-1/2 bg-blue-600/90 text-white px-8 py-3 rounded-full backdrop-blur font-bold text-xl animate-bounce shadow-lg border border-blue-400 z-50",children:m})]})},Se=()=>{const[a,t]=i.useState(y.FIRST_PERSON),[s,o]=i.useState(b.IDLE),[n,r]=i.useState(0),[c,x]=i.useState(0),[m,d]=i.useState(!1),[l,u]=i.useState(0),[w,M]=i.useState(""),f=()=>{t(S=>S===y.FIRST_PERSON?y.THIRD_PERSON:y.FIRST_PERSON)},j=()=>{r(0),x(0),u(0),o(b.PLAYING)},G=S=>{s!==b.GAME_OVER&&(o(b.GAME_OVER),M(S))},P=()=>{r(0),x(0),u(0),o(b.IDLE),setTimeout(()=>o(b.PLAYING),100)},A=l*16e4;return e.jsxs("div",{className:"relative w-full h-full bg-slate-900",children:[e.jsx(ye,{score:Math.floor(n/10),laps:c,isFlying:m,viewMode:a,gameStatus:s,gameOverReason:w,speedKmh:A,onToggleView:f,onStartGame:j,onRestart:P}),e.jsx(ee,{shadows:!0,camera:{fov:75,far:2e3},children:e.jsx(i.Suspense,{fallback:null,children:e.jsxs(se,{gravity:[0,0,0],children:[" ",e.jsx(le,{viewMode:a,gameStatus:s,onGameOver:G,setScore:r,setLaps:x,setIsFlying:d,setSpeed:u}),e.jsx(Me,{gameStatus:s})]})})})]})},C=document.getElementById("root");if(!C)throw new Error("Could not find root element to mount to");const we=U.createRoot(C);we.render(e.jsx(V.StrictMode,{children:e.jsx(Se,{})}));
